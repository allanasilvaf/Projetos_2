import pandas as pd
import numpy as np
from sklearn.linear_model import LogisticRegression
from sklearn.preprocessing import StandardScaler


try:
    df = pd.read_excel('dataset_risco_reprovacao.xlsx')
except FileNotFoundError:
    print("Erro: O arquivo 'dataset_risco_reprovacao.xlsx' não foi encontrado. Gere-o primeiro.")
    exit()

df['trabalha'] = df['trabalha'].map({'S': 1, 'N': 0})
df['tem_filhos'] = df['tem_filhos'].map({'S': 1, 'N': 0})


X = df.drop('reprovado', axis=1)
y = df['reprovado']


scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)


modelo = LogisticRegression()
modelo.fit(X_scaled, y)

def analisar_risco():
    print("\n--- FERRAMENTA DE ANÁLISE DE RISCO ACADÊMICO ---")


    try:
        media = float(input("Média atual na disciplina (0-10): "))
        freq = float(input("Frequência atual (%): "))
        distancia = float(input("Distância casa-universidade (km): "))
        horas = float(input("Horas de estudo diárias: "))
        aulas = int(input("Quantidade de aulas da disciplina (36, 72 ou 108): "))
        materias = int(input("Total de matérias no semestre: "))
        trab = input("Trabalha? (S/N): ").upper()
        filhos = input("Tem filhos? (S/N): ").upper()
        entendimento = int(input("Nível de entendimento do conteúdo (1 a 5): "))

        if freq < 75 or media < 5:
            print("\n" + "="*30)
            print("RESULTADO: REPROVADO")
            print("MOTIVO: Critério obrigatório não atingido (Frequência < 75% ou Média < 5).")
            print("="*30)
            return


        dados_aluno = pd.DataFrame([{
            'media_disciplina': media,
            'distancia_km': distancia,
            'horas_estudo_diaria': horas,
            'frequencia_percentual': freq,
            'qtd_aulas_disciplina': aulas,
            'total_materias_semestre': materias,
            'trabalha': 1 if trab == 'S' else 0,
            'tem_filhos': 1 if filhos == 'S' else 0,
            'entendimento_conteudo': entendimento
        }])

        dados_aluno_scaled = scaler.transform(dados_aluno)
        probabilidade = modelo.predict_proba(dados_aluno_scaled)[0][1]

        print("\n" + "="*30)
        print(f"RISCO CALCULADO: {probabilidade*100:.2f}%")

        if probabilidade > 0.7:
            print("STATUS: ALTO RISCO DE REPROVAÇÃO")
        elif probabilidade > 0.3:
            print("STATUS: ALERTA (Risco Moderado)")
        else:
            print("STATUS: SITUAÇÃO SEGURA")
        print("="*30)

    except ValueError:
        print("Erro: Insira valores numéricos válidos.")
analisar_risco()
